<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ø¯Ø³ØªÛŒØ§Ø± ØµÙˆØªÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒØ´Ø¯Ù‡</title>
    <style>
        body {
            font-family: Tahoma, sans-serif;
            direction: rtl;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 { color: #333; }
        button {
            background-color: #007BFF;
            color: #fff;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        .shortcut-info {
            background: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
        }
        .category {
            background: #fff;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 0 5px #ccc;
            margin-bottom: 25px;
        }
        .category h2 {
            border-bottom: 2px solid #007BFF;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            background-color: #fafafa;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            border-radius: 5px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        li button {
            background-color: #dc3545;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Ø¯Ø³ØªÛŒØ§Ø± ØµÙˆØªÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒØ´Ø¯Ù‡</h1>
    
    <div class="shortcut-info">
        Ú©Ù„ÛŒØ¯ Ù…ÛŒØ§Ù†Ø¨Ø±: 
        <kbd>Ctrl</kbd> + <kbd>Space</kbd>
    </div>

    <button id="startRecording">ğŸ¤ Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·</button>

    <div id="categoriesContainer"></div>

    <script>
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition;

    if (!SpeechRecognition) {
        alert('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² ØªØ´Ø®ÛŒØµ Ú¯ÙØªØ§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯');
    }

    class VoiceAssistant {
        constructor() {
            this.recognition = new SpeechRecognition();
            this.recognition.lang = 'fa-IR';
            this.recognition.continuous = false;
            this.recognition.interimResults = false;

            this.startBtn = document.getElementById('startRecording');
            this.categoriesContainer = document.getElementById('categoriesContainer');

            // Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ùˆ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
            this.categories = {
                shopping: {
                    name: 'ğŸ›’ Ø®Ø±ÛŒØ¯Ù‡Ø§',
                    keywords: ['Ø®Ø±ÛŒØ¯', 'Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª', 'Ù†Ø§Ù†', 'Ù…ÛŒÙˆÙ‡', 'Ù„Ø¨Ù†ÛŒØ§Øª', 'Ø³ÙˆÙ¾Ø±'],
                    items: []
                },
                tasks: {
                    name: 'ğŸ“‹ Ú©Ø§Ø±Ù‡Ø§',
                    keywords: ['Ú©Ø§Ø±', 'Ø§Ù†Ø¬Ø§Ù…', 'ÙˆØ¸ÛŒÙÙ‡', 'Ù¾Ø±ÙˆÚ˜Ù‡', 'ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ'],
                    items: []
                },
                inventory: {
                    name: 'ğŸ“¦ Ù…ÙˆØ¬ÙˆØ¯ÛŒ',
                    keywords: ['Ø§Ù†Ø¨Ø§Ø±', 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ', 'Ú©Ø§Ù„Ø§', 'ÙˆØ±Ù‚', 'Ø§Ù… Ø¯ÛŒ Ø§Ù'],
                    items: []
                },
                reminders: {
                    name: 'â° ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒâ€ŒÙ‡Ø§',
                    keywords: ['ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ', 'ØªØ°Ú©Ø±', 'ÙØ±Ø§Ù…ÙˆØ´ÛŒ', 'Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ'],
                    items: []
                }
            };

            this.loadData();
            this.setupEventListeners();
            this.setupKeyboardShortcut();
            this.renderAllCategories();
        }

        setupEventListeners() {
            this.startBtn.addEventListener('click', () => this.startRecording());

            this.recognition.onstart = () => {
                this.startBtn.textContent = 'ğŸ”´ Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø·...';
                this.startBtn.disabled = true;
                this.showNotification('Ø¶Ø¨Ø· Ø´Ø±ÙˆØ¹ Ø´Ø¯', 'Ù„Ø·ÙØ§Ù‹ ØµØ­Ø¨Øª Ú©Ù†ÛŒØ¯');
            };

            this.recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                this.processTranscript(transcript);
            };

            this.recognition.onend = () => {
                this.startBtn.textContent = 'ğŸ¤ Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·';
                this.startBtn.disabled = false;
            };

            this.recognition.onerror = (event) => {
                console.error('Ø®Ø·Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ú¯ÙØªØ§Ø±:', event.error);
                this.showNotification('Ø®Ø·Ø§', 'Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± ØªØ´Ø®ÛŒØµ Ú¯ÙØªØ§Ø± Ø±Ø® Ø¯Ø§Ø¯');
                this.startBtn.textContent = 'ğŸ¤ Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·';
                this.startBtn.disabled = false;
            };
        }

        setupKeyboardShortcut() {
            document.addEventListener('keydown', (event) => {
                if (event.ctrlKey && event.code === 'Space') {
                    event.preventDefault();
                    this.startRecording();
                }
            });
        }

        startRecording() {
            try {
                this.recognition.start();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·:', error);
                this.showNotification('Ø®Ø·Ø§', 'Ø§Ù…Ú©Ø§Ù† Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø· ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
            }
        }

        processTranscript(text) {
            console.log('Ù…ØªÙ† ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡:', text);

            // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ØªÙ† Ùˆ Ø°Ø®ÛŒØ±Ù‡
            const categoryKey = this.getCategoryKey(text);
            if (!categoryKey) {
                // Ø§Ú¯Ø± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯ØŒ Ø¨Ù‡ Ú©Ø§Ø±Ù‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
                this.saveItem('tasks', text);
                this.showNotification('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ Ø¯Ø± Ú©Ø§Ø±Ù‡Ø§', text);
            } else {
                this.saveItem(categoryKey, text);
                this.showNotification(`Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ Ø¯Ø± ${this.categories[categoryKey].name}`, text);
            }
        }

        getCategoryKey(text) {
            // Ù…ØªÙ† Ø±Ø§ Ø¨Ù‡ Ø­Ø±ÙˆÙ Ú©ÙˆÚ†Ú© ØªØ¨Ø¯ÛŒÙ„ Ú©Ù† Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù† Ø§Ú¯Ø± Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ø¯Ø± Ø¢Ù† Ù‡Ø³Øª
            const lowerText = text.toLowerCase();
            for (const [key, cat] of Object.entries(this.categories)) {
                for (const keyword of cat.keywords) {
                    if (lowerText.includes(keyword)) {
                        return key;
                    }
                }
            }
            return null;
        }

        saveItem(categoryKey, text) {
            if (!this.categories[categoryKey]) return;
            const newItem = {
                id: Date.now(),
                text: text
            };
            this.categories[categoryKey].items.push(newItem);
            this.saveData();
            this.renderCategory(categoryKey);
        }

        loadData() {
            const savedData = JSON.parse(localStorage.getItem('voiceAssistantData') || '{}');
            for (const key in this.categories) {
                if (savedData[key]) {
                    this.categories[key].items = savedData[key];
                }
            }
        }

        saveData() {
            const dataToSave = {};
            for (const key in this.categories) {
                dataToSave[key] = this.categories[key].items;
            }
            localStorage.setItem('voiceAssistantData', JSON.stringify(dataToSave));
        }

        renderAllCategories() {
            this.categoriesContainer.innerHTML = '';
            for (const key in this.categories) {
                this.renderCategory(key);
            }
        }

        renderCategory(categoryKey) {
            let container = document.getElementById('category-' + categoryKey);
            if (!container) {
                container = document.createElement('div');
                container.className = 'category';
                container.id = 'category-' + categoryKey;
                this.categoriesContainer.appendChild(container);
            }

            const cat = this.categories[categoryKey];
            container.innerHTML = `<h2>${cat.name}</h2>`;
            if (cat.items.length === 0) {
                container.innerHTML += '<p style="color:#666;font-style: italic;">Ù…ÙˆØ±Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                return;
            }

            const ul = document.createElement('ul');
            cat.items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.text;

                const delBtn = document.createElement('button');
                delBtn.textContent = 'Ø­Ø°Ù';
                delBtn.title = 'Ø­Ø°Ù Ø¢ÛŒØªÙ…';
                delBtn.onclick = () => {
                    this.deleteItem(categoryKey, item.id);
                };
                li.appendChild(delBtn);
                ul.appendChild(li);
            });

            container.appendChild(ul);
        }

        deleteItem(categoryKey, itemId) {
            this.categories[categoryKey].items = this.categories[categoryKey].items.filter(item => item.id !== itemId);
            this.saveData();
            this.renderCategory(categoryKey);
        }

        showNotification(title, message) {
            if ("Notification" in window) {
                if (Notification.permission !== "granted") {
                    Notification.requestPermission();
                }
                if (Notification.permission === "granted") {
                    new Notification(title, { 
                        body: message,
                        icon: 'ğŸ¤–'
                    });
                }
            } else {
                alert(`${title}: ${message}`);
            }
        }
    }

    // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯Ø³ØªÛŒØ§Ø±
    new VoiceAssistant();
    </script>
</body>
</html>